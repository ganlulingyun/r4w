# =============================================================================
# R4W Lattice ECP5-25K Pin Constraints
# Target: ULX3S or similar ECP5-25K board with CABGA381 package
#
# trace:FR-0085 | ai:claude
# =============================================================================

# =============================================================================
# Clock Input - 25 MHz oscillator
# =============================================================================

LOCATE COMP "clk_25mhz" SITE "G2";
IOBUF PORT "clk_25mhz" PULLMODE=NONE IO_TYPE=LVCMOS33;
FREQUENCY PORT "clk_25mhz" 25 MHZ;

# =============================================================================
# SPI Interface - directly exposed GPIO header pins
# =============================================================================

LOCATE COMP "spi_clk" SITE "H2";
LOCATE COMP "spi_cs_n" SITE "J2";
LOCATE COMP "spi_mosi" SITE "K2";
LOCATE COMP "spi_miso" SITE "J1";

IOBUF PORT "spi_clk" PULLMODE=DOWN IO_TYPE=LVCMOS33;
IOBUF PORT "spi_cs_n" PULLMODE=UP IO_TYPE=LVCMOS33;
IOBUF PORT "spi_mosi" PULLMODE=NONE IO_TYPE=LVCMOS33;
IOBUF PORT "spi_miso" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=4;

# =============================================================================
# I/Q DAC Output - directly on GPIO/PMOD header
# =============================================================================

# DAC I Channel [11:0]
LOCATE COMP "dac_i[0]" SITE "B11";
LOCATE COMP "dac_i[1]" SITE "C11";
LOCATE COMP "dac_i[2]" SITE "A10";
LOCATE COMP "dac_i[3]" SITE "A11";
LOCATE COMP "dac_i[4]" SITE "B10";
LOCATE COMP "dac_i[5]" SITE "C10";
LOCATE COMP "dac_i[6]" SITE "A9";
LOCATE COMP "dac_i[7]" SITE "B9";
LOCATE COMP "dac_i[8]" SITE "C9";
LOCATE COMP "dac_i[9]" SITE "D9";
LOCATE COMP "dac_i[10]" SITE "A8";
LOCATE COMP "dac_i[11]" SITE "B8";

# DAC Q Channel [11:0]
LOCATE COMP "dac_q[0]" SITE "C8";
LOCATE COMP "dac_q[1]" SITE "D8";
LOCATE COMP "dac_q[2]" SITE "A7";
LOCATE COMP "dac_q[3]" SITE "B7";
LOCATE COMP "dac_q[4]" SITE "C7";
LOCATE COMP "dac_q[5]" SITE "D7";
LOCATE COMP "dac_q[6]" SITE "A6";
LOCATE COMP "dac_q[7]" SITE "B6";
LOCATE COMP "dac_q[8]" SITE "C6";
LOCATE COMP "dac_q[9]" SITE "D6";
LOCATE COMP "dac_q[10]" SITE "A5";
LOCATE COMP "dac_q[11]" SITE "B5";

# DAC Valid signal
LOCATE COMP "dac_valid" SITE "C5";

IOBUF PORT "dac_i[*]" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST;
IOBUF PORT "dac_q[*]" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST;
IOBUF PORT "dac_valid" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST;

# =============================================================================
# Status LEDs - ULX3S onboard LEDs
# =============================================================================

LOCATE COMP "led[0]" SITE "B2";
LOCATE COMP "led[1]" SITE "C2";
LOCATE COMP "led[2]" SITE "C1";
LOCATE COMP "led[3]" SITE "D2";
LOCATE COMP "led[4]" SITE "D1";
LOCATE COMP "led[5]" SITE "E2";
LOCATE COMP "led[6]" SITE "E1";
LOCATE COMP "led[7]" SITE "H3";

IOBUF PORT "led[*]" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=4;

# =============================================================================
# SDRAM Interface - AS4C32M16SB on ULX3S (directly driven, currently unused)
# =============================================================================

# SDRAM Clock
LOCATE COMP "sdram_clk" SITE "F19";
IOBUF PORT "sdram_clk" PULLMODE=NONE IO_TYPE=LVCMOS33 DRIVE=8 SLEWRATE=FAST;

# SDRAM Control
LOCATE COMP "sdram_cke" SITE "F20";
LOCATE COMP "sdram_cs_n" SITE "P20";
LOCATE COMP "sdram_we_n" SITE "T20";
LOCATE COMP "sdram_ras_n" SITE "R20";
LOCATE COMP "sdram_cas_n" SITE "T19";

IOBUF PORT "sdram_cke" PULLMODE=NONE IO_TYPE=LVCMOS33;
IOBUF PORT "sdram_cs_n" PULLMODE=NONE IO_TYPE=LVCMOS33;
IOBUF PORT "sdram_we_n" PULLMODE=NONE IO_TYPE=LVCMOS33;
IOBUF PORT "sdram_ras_n" PULLMODE=NONE IO_TYPE=LVCMOS33;
IOBUF PORT "sdram_cas_n" PULLMODE=NONE IO_TYPE=LVCMOS33;

# SDRAM Bank Address [1:0]
LOCATE COMP "sdram_ba[0]" SITE "U20";
LOCATE COMP "sdram_ba[1]" SITE "T18";

IOBUF PORT "sdram_ba[*]" PULLMODE=NONE IO_TYPE=LVCMOS33;

# SDRAM Address [12:0]
LOCATE COMP "sdram_a[0]" SITE "M20";
LOCATE COMP "sdram_a[1]" SITE "M19";
LOCATE COMP "sdram_a[2]" SITE "L20";
LOCATE COMP "sdram_a[3]" SITE "L19";
LOCATE COMP "sdram_a[4]" SITE "K20";
LOCATE COMP "sdram_a[5]" SITE "K19";
LOCATE COMP "sdram_a[6]" SITE "K18";
LOCATE COMP "sdram_a[7]" SITE "J20";
LOCATE COMP "sdram_a[8]" SITE "J19";
LOCATE COMP "sdram_a[9]" SITE "H20";
LOCATE COMP "sdram_a[10]" SITE "N19";
LOCATE COMP "sdram_a[11]" SITE "G20";
LOCATE COMP "sdram_a[12]" SITE "G19";

IOBUF PORT "sdram_a[*]" PULLMODE=NONE IO_TYPE=LVCMOS33;

# SDRAM Data [15:0]
LOCATE COMP "sdram_dq[0]" SITE "J16";
LOCATE COMP "sdram_dq[1]" SITE "L18";
LOCATE COMP "sdram_dq[2]" SITE "M18";
LOCATE COMP "sdram_dq[3]" SITE "N18";
LOCATE COMP "sdram_dq[4]" SITE "P18";
LOCATE COMP "sdram_dq[5]" SITE "T17";
LOCATE COMP "sdram_dq[6]" SITE "T16";
LOCATE COMP "sdram_dq[7]" SITE "U16";
LOCATE COMP "sdram_dq[8]" SITE "J18";
LOCATE COMP "sdram_dq[9]" SITE "J17";
LOCATE COMP "sdram_dq[10]" SITE "G18";
LOCATE COMP "sdram_dq[11]" SITE "F18";
LOCATE COMP "sdram_dq[12]" SITE "E18";
LOCATE COMP "sdram_dq[13]" SITE "E20";
LOCATE COMP "sdram_dq[14]" SITE "D20";
LOCATE COMP "sdram_dq[15]" SITE "D19";

IOBUF PORT "sdram_dq[*]" PULLMODE=NONE IO_TYPE=LVCMOS33;

# SDRAM Data Mask [1:0]
LOCATE COMP "sdram_dqm[0]" SITE "U19";
LOCATE COMP "sdram_dqm[1]" SITE "E19";

IOBUF PORT "sdram_dqm[*]" PULLMODE=NONE IO_TYPE=LVCMOS33;
