# R4W Unified Waveform Specification
# Schema: r4w-waveform-spec v1.1
---
# ============================================================================
# WAVEFORM IDENTITY
# ============================================================================
waveform:
  name: "CW"
  full_name: "Continuous Wave"
  version: "1.0.0"
  description: |
    Continuous Wave (CW) - an unmodulated carrier signal.
    The simplest possible waveform: a pure sinusoid at the carrier frequency.
    Used for carrier recovery testing, beacon signals, and as a building block.

  classification:
    type: "analog"
    category: "unmodulated"

  standards: []

  authors:
    - name: "R4W Team"

# ============================================================================
# SIGNAL CHARACTERISTICS
# ============================================================================
signal:
  carrier:
    frequency_hz: 1000.0        # Default carrier frequency
    amplitude: 1.0              # Normalized amplitude [0, 1]
    phase_deg: 0.0              # Initial phase

  bandwidth:
    theoretical_hz: 0           # Ideal CW has zero bandwidth
    practical_hz: 1             # Practical: ~1/duration due to windowing

  power:
    normalized_dbfs: 0.0        # Full scale

# ============================================================================
# TIMING
# ============================================================================
timing:
  sample_rate: 8000             # Default sample rate (Hz)
  samples_per_cycle: 8          # At default carrier freq
  duration_s: 1.0               # Default duration
  continuous: true              # CW is continuous by nature

# ============================================================================
# TX PIPELINE
# ============================================================================
tx:
  description: |
    CW generation is trivially simple: generate a complex exponential
    at the carrier frequency. No modulation, no encoding.

  blocks:
    - id: 1
      name: "Carrier Generator"
      type: "Bit Source"
      enabled: true
      pattern: "tone"

  connections: []  # Single block, no connections needed

# ============================================================================
# RX PIPELINE
# ============================================================================
rx:
  description: |
    CW reception: measure carrier frequency, phase, and amplitude.
    Used for calibration and carrier recovery testing.

  blocks:
    - id: 101
      name: "AGC"
      type: "AGC"
      enabled: true
      mode: "Slow"
      target_db: 0.0

    - id: 102
      name: "Carrier Recovery"
      type: "Carrier Recovery"
      enabled: true
      algorithm: "CostasLoop"
      loop_bw: 0.001

  connections:
    - from: [101, 0]
      to: [102, 0]

# ============================================================================
# RUST IMPLEMENTATION
# ============================================================================
implementation:
  module: "cw"
  struct_name: "CwWaveform"

  modulate: |
    // CW modulation: generate carrier samples
    // output[n] = A * exp(j * 2 * pi * f_c * n / f_s + phi)
    let phase_increment = 2.0 * PI * self.carrier_freq / self.sample_rate;
    samples.iter().enumerate().map(|(n, _)| {
        let phase = self.initial_phase + phase_increment * n as f64;
        IQSample::new(phase.cos() as f32, phase.sin() as f32) * self.amplitude
    }).collect()

  demodulate: |
    // CW demodulation: measure carrier frequency and phase
    // Use FFT peak detection or PLL

  tests:
    - name: "constant_envelope"
      description: "Verify output has constant amplitude"
    - name: "correct_frequency"
      description: "Verify FFT peak at carrier frequency"
    - name: "phase_continuity"
      description: "Verify no phase discontinuities"

# ============================================================================
# VISUALIZATION
# ============================================================================
visualization:
  constellation:
    type: "single_point"
    points: [[1.0, 0.0]]  # Single point on real axis

  spectrum:
    type: "single_tone"
    expected_peaks:
      - frequency_hz: 1000.0
        relative_power_db: 0.0

  time_domain:
    type: "sinusoid"

# ============================================================================
# APPLICATIONS
# ============================================================================
applications:
  - "Carrier recovery testing"
  - "Beacon signals"
  - "Channel sounding"
  - "Reference signal generation"
  - "LO leakage measurement"
  - "Building block for complex waveforms"
